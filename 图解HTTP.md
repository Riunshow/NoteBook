## 图解 HTTP

___

### 第 1 章　了解 Web 及网络基础

#### TCP/IP

* 应用层 -> 传输层 -> 网络层 -> 链路层
  * HTTP -> TCP -> IP -> 网络
* IP 地址指明了节点被分配到的地址，MAC 地址是指网卡所属的固定 地址。
* 使用 ARP 协议凭借 MAC 地址进行通信
  * ARP 是一种用以解析地址的协议，根据通信方 的 IP 地址就可以反查出对应的 MAC 地址。
* TCP 三次握手
  * 发送端首先发送一个带 SYN 标志的数据包给对方。接收端收到后， 回传一个带有 SYN/ACK 标志的数据包以示传达确认信息。最后，发 送端再回传一个带 ACK 标志的数据包，代表“握手”结束。
  * 若在握手过程中某个阶段莫名中断，TCP 协议会再次以相同的顺序发 送相同的数据包。
  * **除了上述三次握手，TCP 协议还有其他各种手段来保证通信的可靠性.**

#### DNS

DNS（Domain Name System）服务是和 HTTP 协议一样位于应用层的 协议。它提供域名到 IP 地址之间的解析服务。

#### URI  URL 的区别

* URI 统一资源标识符,  URL 统一资源定位符
* URI 用字符串标识某一互联网资源，而 URL 表示资源的地点（互联 网上所处的位置）。可见 URL 是 URI 的子集
* URI是定义  URL 是标识

___

### 第 2 章　简单的 HTTP 协议

#### HTTP

* HTTP 是一种不保存状态，即无状态（stateless）协议。
* 在 HTTP/1.1 中，所有的连接默认都是持久连接
* 持久连接使得多数请求以管线化（pipelining）方式发送成为可能, 管线化技术则比持久连接还 要快。请求数越多，时间差就越明显。
* 基于 cookie 的状态管理

| 方法    | 说明                   | 支持的 HTTP 协议版本 |
| ------- | ---------------------- | -------------------- |
| GET     | 获取资源               | 1.0、1.1             |
| POST    | 传输实体主体           | 1.0、1.1             |
| PUT     | 传输文件               | 1.0、1.1             |
| HEAD    | 获得报文首部           | 1.0、1.1             |
| DELETE  | 删除文件               | 1.0、1.1             |
| OPTIONS | 询问支持的方法         | 1.1                  |
| TRACE   | 追踪路径               | 1.1                  |
| CONNECT | 要求用隧道协议连接代理 | 1.1                  |
| LINK    | 建立和资源之间的联系   | 1.0                  |
| UNLINE  | 断开连接关系           | 1.0                  |

___

### 第 3 章　HTTP 报文内的 HTTP 信息

#### 编码提升传输速率

* 常用的内容编码有以下几种。
  * gzip（GNU zip） compress（UNIX 系统的标准压缩） deflate（zlib） identity（不进行编码）

* 分割发送的分块传输编码

#### 获取部分内容的范围请求

* 执行范围请求时，会用到首部字段 Range 来指定资源的 byte 范围。

  ```
  byte 范围的指定形式如下。
  
  5001~10 000 字节
  
  > Range: bytes=5001-10000
  
  从 5001 字节之后全部的
  
  > Range: bytes=5001-
  
  从一开始到 3000 字节和 5000~7000 字节的多重范围
  
  > Range: bytes=-3000, 5000-7000
  ```

#### 内容协商返回最合适的内容

> 同一个 Web 网站有可能存在着多份相同内容的页面。比如英语版和 中文版的 Web 页面，它们内容上虽相同，但使用的语言却不同。
>
> 当浏览器的默认语言为英语或中文，访问相同 URI 的 Web 页面时， 则会显示对应的英语版或中文版的 Web 页面。这样的机制称为内容 协商（Content Negotiation）。

* 涉及到的头部字段
  * Accept
  * Accept-Charset
  * Accept-Encoding
  * Accept-Language
  * Content-Language
* 内容协商技术有以下 3 种类型。
  * 服务器驱动协商（Server-driven Negotiation） 由服务器端进行内容协商。以请求的首部字段为参考，在服务器端自 动处理。但对用户来说，以浏览器发送的信息作为判定的依据，并不 一定能筛选出最优内容。
  * 客户端驱动协商（Agent-driven Negotiation） 由客户端进行内容协商的方式。用户从浏览器显示的可选项列表中手 动选择。还可以利用 JavaScript 脚本在 Web 页面上自动进行上述选 择。比如按 OS 的类型或浏览器类型，自行切换成 PC 版页面或手机 版页面。
  * 透明协商（Transparent Negotiation） 是服务器驱动和客户端驱动的结合体，是由服务_器端和客户端各自进 行内容协商的一种方法。

___

### 第 4 章　返回结果的 HTTP 状态 码

#### 状态码的类别

|      | 类别                             | 原因短语                   |
| ---- | -------------------------------- | -------------------------- |
| 1XX  | Informational（信息性状态码）    | 接收的请求正在处理         |
| 2XX  | Success（成功状态码）            | 请求正常处理完毕           |
| 3XX  | Redirection（重定向状态码）      | 需要进行附加操作以完成请求 |
| 4XX  | Client Error（客户端错误状态码） | 服务器无法处理请求         |
| 5XX  | Server Error（服务器错误状态码） | 服务器处理请求出错         |

#### 2XX  成功

 * 200 OK
    * 表示从客户端发来的请求在服务器端被正常处理了。
    * 在响应报文内，随状态码一起返回的信息会因方法的不同而发生改 变。比如，使用 GET 方法时，对应请求资源的实体会作为响应返 回；而使用 HEAD 方法时，对应请求资源的实体首部不随报文主体 作为响应返回（即在响应中只返回首部，不会返回实体的主体部 分）。
 * 204 No Content
   	* 该状态码代表服务器接收的请求已成功处理，但在返回的响应报文中 不含实体的主体部分。另外，也不允许返回任何实体的主体。比如， 当从浏览器发出请求处理后，返回 204 响应，那么浏览器显示的页面 不发生更新。
   	* 一般在只需要从客户端往服务器发送信息，而对客户端不需要发送新信息内容的情况下使用。
* 206 Partial Content
  * 该状态码表示客户端进行了范围请求，而服务器成功执行了这部分的 GET 请求。响应报文中包含由 Content-Range 指定范围的实体内容。

#### 3XX  重定向

* 301 Moved Permanently
  * 永久性重定向。该状态码表示请求的资源已被分配了新的 URI，以后 应使用资源现在所指的 URI。也就是说，如果已经把资源对应的 URI 保存为书签了，这时应该按 Location 首部字段提示的 URI 重新保存。
  * 像下方给出的请求 URI，当指定资源路径的最后忘记添加斜杠“/”，就 会产生 301 状态码。http://example.com/sample
* 302 Found
  * 临时性重定向。该状态码表示请求的资源已被分配了新的 URI，希望 用户（本次）能使用新的 URI 访问。
  * 和 301 Moved Permanently 状态码相似，但 302 状态码代表的资源不 是被永久移动，只是临时性质的。换句话说，已移动的资源对应的 URI 将来还有可能发生改变。比如，用户把 URI 保存成书签，但不会 像 301 状态码出现时那样去更新书签，而是仍旧保留返回 302 状态码 的页面对应的 URI。
* 303 See Other
  * 该状态码表示由于请求对应的资源存在着另一个 URI，应使用 GET 方法定向获取请求的资源。
  * 303 状态码和 302 Found 状态码有着相同的功能，但 303 状态码明确 表示客户端应当采用 GET 方法获取资源，这点与 302 状态码有区 别。
  * 比如，当使用 POST 方法访问 CGI 程序，其执行后的处理结果是希望 客户端能以 GET 方法重定向到另一个 URI 上去时，返回 303 状态 码。虽然 302 Found 状态码也可以实现相同的功能，但这里使用 303状态码是最理想的。
* 304 Not Modified
  * 该状态码表示客户端发送**附带条件的请求**时，服务器端允许请求访 问资源，但未满足条件的情况。304 状态码返回时，不包含任何响应 的主体部分。304 虽然被划分在 3XX 类别中，但是和重定向没有关 系。
  * **附带条件的请求**是指采用 GET 方法的请求报文中包含 If-Match，If-ModifiedSince，If-None-Match，If-Range，If-Unmodified-Since 中任一首部。
* 307 Temporary Redirect
  * 临时重定向。该状态码与 302 Found 有着相同的含义。尽管 302 标准禁止 POST 变换成 GET，但实际使用时大家并不遵守。307 会遵照浏览器标准，不会从 POST 变成 GET。但是，对于处理响 应时的行为，每种浏览器有可能出现不同的情况。


#### 4XX  客户端错误

* 400 Bad Request
  * 该状态码表示请求报文中存在语法错误。当错误发生时，需修改请求的内容后再次发送请求。另外，浏览器会像 200 OK 一样对待该状态 码。
* 401 Unauthorized
  * 该状态码表示发送的请求需要有通过 HTTP 认证（BASIC 认证、 DIGEST 认证）的认证信息。另外若之前已进行过 1 次请求，则表示 用 户认证失败。
* 403 Forbidden
  * 该状态码表明对请求资源的访问被服务器拒绝了。服务器端没有必要 给出拒绝的详细理由，但如果想作说明的话，可以在实体的主体部分对原因进行描述，这样就能让用户看到了。
  * 未获得文件系统的访问授权，访问权限出现某些问题（从未授权的发 送源 IP 地址试图访问）等列举的情况都可能是发生 403 的原因。
* 404 Not Found
  * 该状态码表明服务器上无法找到请求的资源。除此之外，也可以在服 务器端拒绝请求且不想说明理由时使用。
* 405 Method Not Allowed
  * 请求方法不被允许

#### 5XX  服务器错误

* 500 Internal Server Error
  * 该状态码表明服务器端在执行请求时发生了错误。也有可能是 Web 应用存在的 bug 或某些临时的故障。
* 503 Service Unavailable
  * 该状态码表明服务器暂时处于超负载或正在进行停机维护，现在无法 处理请求。如果事先得知解除以上状况需要的时间，最好写入 RetryAfter 首部字段再返回给客户端。
  * 状态码和状况的不一致, 不少返回的状态码响应都是错误的，但是用户可能察觉不到这点。 比如 Web 应用程序内部发生错误，状态码依然返回 200 OK，这种 情况也经常遇到。


### 第 5 章　与 HTTP 协作的 Web 服 务器

### 第 6 章　HTTP 首部

### 第 7 章　确保 Web 安全的 HTTPS

### 第 8 章　确认访问用户身份的认 证

### 第 9 章　基于 HTTP 的功能追加 协议

### 第 10 章　构建 Web 内容的技术

### 第 11 章　Web 的攻击技术



